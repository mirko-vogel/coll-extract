#import string, re
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Collocation Review</title>
  <style>
  body { direction: rtl; margin: 0px; width: 100%; font-size: 30px}
  div.header {width: 100%; color: white; background: black; padding: 10px; position: fixed}
 
  div.header a:link, a:visited {text-decoration: none; color: white}
  div.header a:hover {text-decoration: underline}

	h1 {font-size: 30px; color: LightGrey; font-weight: normal; clear: both; padding-top:50px}

  div.content {padding: 20px;}
	div.coll_group {}

  div.box { width: 350px; float: right; border: 1px solid black; margin: 20px; min-height: 250px}

  div.box-title, div.box-content { margin: 0px; padding: 10px; }

  div.box-title { border-bottom: 1px solid black; font-size: 23px; }
  div.box-title.got-fb-useful { background-color: green ; font-weight: bold}
  div.box-title.got-fb-correct { background-color: LightGreen ; font-weight: bold}
  div.box-title.got-fb-wrong { background-color: DarkRed }

  div.box-content { font-size: 15px; line-height: 25px; }
  div.box-content.got-fb-correct { color: green }
  div.box-content.got-fb-wrong { color: DarkRed }
  
  span.collocation { }  

  span.example { }
  span.collocation_word { font-weight: bold }

  span.coll-fb-buttons { float:left;}
  button { border: 0px; height: 30px; margin: 0px; background-color: transparent; }
  button:hover { background-color: LightGrey }
  button.fb-useful { color: green; }
  button.fb-correct { color: LightGreen; }
  button.fb-wrong { color: DarkRed; }  

  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
#raw
  <script type="text/javascript">
		function rate_collocation(_id, rating)
		{
			$.ajax({
				type: "POST",
				url: "rate_collocation",
				data: {"_id": _id, "rating": rating}
			});
			$("#coll-" + _id).attr("class", "box-title got-fb-" + rating);
		}

  </script>
#end raw
</head>

<body>
<div class="header">
مُرَيجَع
>
<a href="/">
تنقيح المتواردات اللفظية
</a>
>
صفات لاسم "اتفاقية"
</div>

<div class="content">

#def collocation_rating_class($c)
	#if not "rating" in $c:
		#return
	#elif len($c.rating) > 1:
    mixed
  #else
    got-fb-$c.rating.keys[0]
  #end if
#end def

#def pretty_print_example($e)
  #set $toks = $e.sentence.split(" ")
	#set $hl_toks = ["<b>%s</b>" % w if n in $e.coll_pos else w for (n, w) in $enumerate($toks)]
  #set hl = $str.join(" ", $hl_toks)
  ## Yes, this is embarrasing
  $re.sub(u" ،", u"،", re.sub(u" [.]", u".", $hl))
#end def
#def coll_tooltip($c)
	#for $f in $sorted($c.inflected_forms.values, key=lambda ic: ic["freq"], reverse=True)
$f.core_word $f.coll_word ($f.freq)
	#end for
----------
تردد إجمالي: $c.freq
#end def

#def render_coll_box($c)
<%
def canonical_form(c):
	if c["inflected_forms"]:
		for ic in c["inflected_forms"].itervalues():
			if not ic["core_word"].startswith(u"ال"):
				return "%s %s" % (ic["core_word"], ic["coll_word"])
	
	return "%s %s" % (c["core_lemma"], c["coll_lemma"])
%>

	#set $id = $c['_id']
	<div class="box">
		<div class="box-title $collocation_rating_class($c)" id="coll-$id">
			<span class="collocation" title="$coll_tooltip($c)"> 
				$canonical_form($c)
			</span>
			<span class="coll-fb-buttons">
				<button onclick="rate_collocation('$id', 'useful')" class="fb-useful">&#10004;&#10004;</a>
				<button onclick="rate_collocation('$id', 'correct')" class="fb-correct">&#10004;</a>
				<button onclick="rate_collocation('$id', 'wrong')" class="fb-wrong">&#10008;</a>
			</span>
		</div>
		<div class="box-content" id="ex-$id">
			<span class="example">
				#if $c.inflected_forms
					#set $ic_key, $ic = $next($c.inflected_forms.iteritems)
				  #set e = $next(ic["examples"].itervalues())
					$pretty_print_example($e)
				#end if
				<button onclick="set_class('ex-$id', 'box-content got-fb-correct')" class="fb-correct">&#10004;</button>
				<button onclick="set_class('ex-$id', 'box-content got-fb-wrong')" class="fb-wrong">&#10008;</button>
			</span>
		</div>
	</div>
#end def

#set $candidates = sorted($candidates, key=lambda c: c["freq"], reverse=True)

<div class="coll_group">
<h1> متواردات لفظية لم تقيم بعد</h1>
#for ($n, $c) in $enumerate($candidates):
	#if not "rating" in $c:
		$render_coll_box($c)
  #end if
#end for
</div>

<div class="coll_group">
<h1> متواردات لفظية تم تقييمها </h1>
#for ($n, $c) in $enumerate($candidates):
	#if "rating" in $c:
		$render_coll_box($c)
  #end if
#end for
</div>
</div>

</body>
</html>

